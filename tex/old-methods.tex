%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% TO ORGANIZE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{OLD METHODS TEXT}

We constructed three experimental environments, abbreviated hereafter as ``ENV-A'', ``ENV-B'', and ``ENV-ALL'' ([Figure XX]).
In ENV-A, organisms are rewarded for performing the NOT, AND, and OR Boolean logic tasks, but are punished for performing the NAND, OR-NOT, and AND-NOT logic tasks.
Conversely in ENV-B, organisms are rewarded for performing NAND, OR-NOT, and AND-NOT, but are punished for performing NOT, AND, and OR.  
Finally, in ENV-ALL, all six tasks are rewarded and none are punished.
Each rewarded task performed by an organism doubles their metabolic rate (allowing them to execute twice as many instructions in the same amount of time), and each punished task performed halves their metabolic rate.
% @AML: Add deleted text to figure caption.
% Thus, organisms with phenotypes that align with their current environment will quickly outcompete those with mismatched phenotypes.  
% Indeed, a perfect match in ENV-A or ENV-B will have a metabolic bonus of $\times{8}$, a perfect mismatch will have a penalty of $\times{0.125}$, and an organism that does no tasks or all tasks will not have a modifier at all. 

% Sensory instructions + control flow and controlling the capacity for plasticity
Organisms can differentiate ENV-A and ENV-B by executing one of six sensory instructions, each associated with a particular logical task (NOT, NAND, AND, OR-NOT, OR, and AND-NOT); these sensory instructions detect whether their associated task is currently rewarded or punished (see Supplemental Section [blah] for details [cite]).
% Indeed, the values of each of these tasks are perfectly correlated; thus, executing any of the six sensory instructions can differentiate between ENV-A and ENV-B. 
By using sensory information in combination with execution flow-control instructions, organisms can conditionally perform the different logic tasks depending on the current environmental conditions.
We can experimentally control the capacity for phenotypic plasticity by disabling sensory instructions.

% In all experiments, we determine if a given genotype is plastic by evaluating that genotype in both ENV-A and ENV-B. 
% If the genotype expresses a different set of tasks in each environment, we categorize that genotype as phenotypically plastic.
% We consider a genotype to be \textit{optimally} plastic if it expresses each of the rewarded tasks in a given environment and none of the punished tasks in that environment.

% @AML: Nkrumah switched genotype => organism. I don't think organism is quite right because we don't necessarily evaluate the organism in both environments. It's more like we culture two clones: one in env-a and one in env-b. Is there a clearer way to explain this?
% In all experiments, we determine if a given genotype is phenotypically plastic by testing it in both ENV-A and ENV-B. 
We consider a genotype to be plastic if it expresses a different set of tasks when [tested/cultured] in ENV-A than when [tested] in ENV-B.
Genotypes labeled \textit{optimally} plastic express each of the rewarded tasks in a given environment and none of the punished tasks in that environment.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Overview of experimental design (two phases)
We conducted a series of experiments using Avida to investigate how the evolution of adaptive plasticity alters evolutionary dynamics and influences evolutionary outcomes in fluctuating environments.
These experiments build directly on previous digital evolution studies on the evolution of adaptive phenotypic plasticity \citep{clune_investigating_2007,lalejini_evolutionary_2016} and on the evolutionary consequences of fluctuating environments \citep{wilke_evolution_2001,canino-koning_fluctuating_2019}.
In our work, each replicate (across all experiments) comprised two phases that each lasted for 200,000 updates\footnote{
    One update in Avida is the amount of time required for the average organism to execute 30 instructions. 
    See \citep{ofria_avida:_2009} for more details.
} 
of evolution (approximately 30,000 to 40,000 generations).  
[Figure XX overviews our experimental design.]


During phase one, we acclimated a common ancestral strain (capable only of self-replication) to each of our treatment conditions (described below).
After phase one, we used the most abundant genotype from each replicate to found a new population for phase two.
During phase two, we evolved these new populations in their treatment-specific environment, tracking their evolutionary history as well as saving the full final population.
All comparisons between treatments were performed on data from populations during phase two evolution.

% Phase one was a treatment-specific adaptation phase where we founded populations with a common ancestor (capable only of self-replication) to generate the seed organism (with or without plasticity) that we used to initialize phase two.
% Phase two was an experimental phase where we used the seed organism to produce a new population that continued to evolve in the same treatment-specific environment, albeit with a possible experimental manipulation, as described below.
% In phase two, we tracked the evolutionary histories of evolving populations to allow for analysis of underlying evolutionary dynamics, as well as saving the full final population.
% All comparisons between treatments were performed on data from populations during phase two evolution.

% \input{tex/figures/experimental-design}

In each experiment described below, we conducted 100 replicates each of three treatments:
\begin{enumerate}
    \item PLASTIC: the environment fluctuates between ENV-A and ENV-B, and digital organisms can differentiate between ENV-A and ENV-B using sensory instructions. %As such, adaptive plasticity can evolve.
    \item NON-PLASTIC: the environment fluctuations between ENV-A and ENV-B, but sensory instructions are disabled. %As such, plasticity cannot evolve.
    \item STATIC: a control where organisms evolve in a constant environment (ENV-ALL). %, and thus sensors provide no information.
\end{enumerate}

In both the PLASTIC and NON-PLASTIC conditions, the environment cycles between equal-length periods of ENV-A and ENV-B.
Each of these periods persist for 100 updates (approximately 15 to 20 generations); thus, populations experience a total of 1,000 full periods of ENV-A and 1,000 full periods of ENV-B during each phase.

\subsubsection{Phase One}

Phase one gives populations time to adapt to their treatment conditions, affording adaptive phenotypic plasticity the opportunity to evolve \textit{de novo} in the PLASTIC treatment.
At the end of phase one, we extract the most abundant (i.e., dominant) genotype from each replicate population to seed a new population for phase two.
The evolution of optimal phenotypic plasticity is not a guaranteed outcome in the PLASTIC treatment; for this condition, we only continue to phase two if the dominant genotype perfectly regulates which tasks it performs in ENV-A and ENV-B.
This ensures that measurements taken during the experimental phase of the PLASTIC treatment are representative of populations with adaptive phenotypic plasticity.

\vspace{1cm}
\subsubsection{Metrics for quantifying the tape of life}
\label{sec:methods:measurements}
% @AML: Like the idea of an even more general heading. Some ideas:
%  - Measurements
%  - Measuring evolutionary change
%  - Measuring evolutionary history
%  - Measuring evolutionary dynamics
%  - Quantifying the tape of life (call out to the quantifying tape of life paper!)
%  - Quantifying evolutionary change

We analyzed the effects of phenotypic plasticity on evolutionary dynamics by quantifying the evolutionary histories of evolving populations.
Specifically, we examined four metrics (the first three are reviewed in \citep{dolson_interpreting_2020}):
(1) number of coalescence events that have occurred, which indicates the frequency of selective sweeps in the population;
(2) mutation accumulation, which is the sum of all mutations that have occurred along a lineage;
(3) phenotypic volatility, which is the number of instances where parent and offspring phenotypes do not match along a lineage, as measured under a given condition;
and (4) mutational stability, which is the proportion of \textit{mutated} offspring along a lineage whose phenotypes do not match that of their parent, as measured under a given condition.

% --- Coalescence/Selective sweeps ---
% @AML: TODO - move some of these details to discussion
In asexual populations without ecological interactions fostering coexistence, phylogenies should coalesce periodically; that is, the most recent common ancestor shared by the extant population should change.
The rate that these coalescence events occur can indicate the strength of selection.
For example, populations under strong selective pressures should experience more rapid coalescence events than populations under weaker selection \citep{dolson_interpreting_2020}.

% --- Lineages ---
A complete lineage describes a continuous line of descent, specifying an unbroken chain of parent-offspring relationships.
For phase two of each experimental replicate, we isolated a representative lineage from its seed organism to a member of the dominant genotype at the end of its evolution.
Because our experimental treatments do not support long-term coexistence, each of these lineages represents the majority of evolutionary history from a given population at the end of our experiment.

% -- Mutation accumulation ---
% @AML: TODO - move some of these details to discussion
Mutation accumulation measures the total number of mutations along a lineage \citep{dolson_interpreting_2020}.
For example, a genotype on the lineage that is two substitution mutations and one insertion mutation away from its parent genotype increases mutation accumulation by three.
Note that for this measure of mutation accumulation, we do not distinguish between beneficial, neutral, or deleterious mutations. 
Instead, we use mutation accumulation as a measure of \textit{overall} genomic change.

% -- Phenotypic volatility --
We measure phenotypic volatility as the sum of mutationally-induced phenotypic changes observed along a lineage under a given condition \citep{dolson_interpreting_2020}.
To calculate phenotypic volatility for a given lineage, we express (i.e., evaluate) each genotype along that lineage in a treatment-specific condition, and we sum the number of changes in task profiles between consecutive genotypes.
For lineages evolved in environments fluctuating between ENV-A and ENV-B, we evaluate genotypes in both environmental conditions and count only changes in its \textit{aggregate} phenotype; this technique ensures that environmentally-induced changes are excluded from our measurement.
This phenotypic volatility metric illuminates the rate at which accumulated genetic changes actually change the phenotype along a lineage. % @AML: need better language to talk about 'comprehensive/full' phenotype

% -- Mutational stability --
We measured mutational stability as the fraction of mutated offspring along a given lineage with a different phenotype than their parent.
For lineages evolved in fluctuating environments, we evaluated mutants under both ENV-A and ENV-B and counted all changes in the \textit{aggregate} task profile; like our measure of phenotypic volatility, this technique ensures that environmentally-induced changes are excluded from our measurement.
Mutational stability examines the frequency at which mutations effect changes in an offspring's phenotype.

\vspace{1cm}
\subsubsection{Experiment I: Does adaptive phenotypic plasticity constrain evolutionary change?}
\label{sec:methods:experiment-evolutionary-dynamics}

We examined how the evolution of adaptive plasticity affects the rate of subsequent evolutionary change in fluctuating environments.
Specifically, we examined the four metrics (described above) across PLASTIC, NON-PLASTIC, and STATIC treatments:
(1) number of coalescence events,
(2) mutation accumulation,
(3) phenotypic volatility,
and (4) mutational stability.

% -- genetic architecture analysis --
% How does this tie to genetic architecture, and why would that affect rates of change?
To investigate \textit{why} phenotypic plasticity might alter the rate of evolutionary change, we examine the genetic architecture of organisms evolved under each condition.
While Avida clearly defines the mechanics of each instruction, the emergent function of an instruction depends on its context within a genome. 
For an individual organism, we can perform knockout experiments to identify which instructions are responsible for producing a given phenotypic outcome.

To perform a knockout, we duplicate the organism, replacing a single instruction with an inert ``no-operation'' instruction.
We then identify any phenotypic changes by contrasting the execution results of the ``knockout'' organism and the original.
Such changes provide evidence of the role that the original instruction must have played in the genome.
For example, when an organism performs the NAND task but loses it when an instruction is knocked out, we categorize that instruction as part of the NAND task machinery.
We use knockout experiments to characterize the role of each instruction in the genomes of every organism along all study lineages, revealing how genetic architectures change over time.
[specifically, we compared x, y, and z...].

\vspace{0.5cm}
\subsubsection{Experiment II: Does adaptive phenotypic plasticity promote the subsequent evolution of novel traits?}
\label{sec:methods:experiment-novel-traits}

% -- overview --
We tested how the evolution of adaptive phenotypic plasticity influences the potential for novel adaptive traits to evolve.
In this experiment (across all treatments), we used the expanded task set of 77 Boolean logic tasks during the second phase of evolution \citep{ofria_avida:_2009}.
This task set includes the six phase one tasks (NOT, NAND, AND, OR-NOT, OR, and AND-NOT; hereafter called ``base'' tasks) plus 71 new phase two tasks (hereafter called ``novel'' tasks).
Across all experimental treatments, organisms could improve their metabolic rate by performing any of the 71 novel tasks.
The six base tasks were still present in the environment and continued to be rewarded or punished according to the particular treatment.
% @AML: line below is cut-able if necessary
As such, in fluctuating environments, the six base tasks continued to fluctuate, but the additional 71 tasks were always rewarded; in static environments, performing any of the 77 logic tasks was always beneficial.

% --additional tasks--
An organism receives a \novelTraitsReward\ metabolic rate improvement for each of the novel tasks that it performs (limited to one reward per unique task).
This reward provides a selective pressure to evolve these tasks, but their benefits do not overwhelm existing treatment-specific selective pressures.
As such, populations in the PLASTIC and NON-PLASTIC treatments cannot easily escape environmental fluctuations by abandoning the fluctuating base tasks.
% Performing a fluctuating task in the appropriate environment ([a,b,c] in ENV-A and [x,y,z] in ENV-B) results in a two-fold metabolic rate improvement, whereas, at a \novelTraitsReward\ reward rate, 8 additional tasks are equivalent single rewarded fluctuating task; further, the majority of the 71 additional tasks require more complex genetic machinery to perform than the six fluctuating tasks.

% - performance evaluation -
We measured task discovery, task performance, and task loss along successful lineages to examine the extent to which populations are capable of acquiring and retaining novel traits. % are more or less evolvable
We limited these measures to the novel task set, excluding the six base tasks:

\begin{itemize}

\item \textbf{Task discovery} measures a given lineage's level of \textit{exploration} of the fitness landscape (i.e., the mapping between genetic space and phenotype space) \citep{canino-koning_fluctuating_2019}. 
We calculated task discovery as the total number of unique tasks ever performed along the lineage, even if a task is later lost; as such, a lineage's task discovery measurement could range from 0 to 71.

\item \textbf{Task performance} measures the level of \textit{exploitation} of the fitness landscape at a given point in time.
In this work, we summarized task performance using a count of unique tasks completed by a representative organism from each population.
We focused on an organism from the dominant genotype at the end of the experiment as the most representative phenotype in the evolved population.

\item \textbf{Task loss} measures how often a lineage fails to retain evolved traits over time and thus indicates the ability for traits to be maintained over time.
We calculated task loss as the number of times along a lineage that a task is performed by a parent but not its offspring. 

\end{itemize}

\vspace{0.5cm}
% Alternative headings:
% - Does adaptive phenotypic plasticity decrease deleterious hitchhiking?
\subsubsection{Experiment III: Does adaptive phenotypic plasticity influence the accumulation deleterious genes?}
\label{sec:methods:experiment-deleterious-hitchhiking}

% Given that preliminary experiments showed numerous deleterious mutations, we conducted tests to determine the role of genetic hitchhiking in these results.
% [To test each of the PLASTIC, NON-PLASTIC, and STATIC treatment's susceptibility to hitchhiking, we added a \code{poison} instruction to the instruction set during the second phase of this experiment.]
To examine the propensity for deleterious genes to accumulate in genomes under each of the PLASTIC, NON-PLASTIC, and STATIC treatments, we added a \code{poison} instruction to the instruction set during the second phase of this experiment.
When executed by an organism, the \code{poison} instruction reduces the organism's metabolic rate (and thus reproductive success), but does not otherwise alter the organism's function.
Here, we imposed a 10\% penalty each time an organism executed this instruction, making the instruct explicitly deleterious (see [supplementary material] for tests with 3\% and 30\% penalties, which produced consistent experimental results).

% - measurements -
At the beginning of phase two, the \code{poison} instruction is not present in the population as it was not part of the instruction set during the first phase of evolution.
However, by adding \code{poison} to the instruction set during phase two, it can be introduced via a mutation.
% susceptibility to [genetic hitchhiking]
We measured deleterious mutation accumulation by examining the number of times a \code{poison} instruction is executed by each genotype along the dominant lineage (including the final dominant genotype).
Because the \code{poison} instruction is explicitly deleterious, selection should purge mutations that increase \code{poison} execution in the offspring phenotype.
As such, we expected such mutations to show up in successful lineages either as accumulated cryptic variation in plastic genomes or via hitchhiking with linked beneficial mutations [cite].
% we expect it to show up in successful lineages either as accumulated cryptic variation in plastic genomes or as a result of hitchhiking 
% [only as a result of hitchhiking], as selection should purge deleterious mutations not linked to beneficial mutations.